version: "3.9"
services:
  web:
    build:
      context: ./
      dockerfile: ./docker/prod/web/Dockerfile
    depends_on:
      - csdl
    networks:
      - web
      - default
    labels:
      traefik.enable: true
      traefik.http.routers.staging-blog.rule: Host(`staging.blog.stunited.vn`)
      traefik.http.routers.staging-blog.entrypoints: websecure
      traefik.http.routers.staging-blog.tls.certresolver: myresolver
    
  csdl:
    image: mysql:8.0.22
    platform: linux/x86_64
    command: --default-authentication-plugin=mysql_native_password
    environment:
      MYSQL_ROOT_PASSWORD: ghostly
      MYSQL_DATABASE: blog
    networks:
      - default

  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    environment:
      PMA_HOST: csdl
      MYSQL_ROOT_PASSWORD: ghostly
    labels:
      traefik.enable: true
      traefik.http.routers.phpmyadmin.rule: Host(`phpmyadmin.staging.blog.stunited.vn`)
      traefik.http.routers.phpmyadmin.entrypoints: websecure
      traefik.http.routers.phpmyadmin.tls.certresolver: myresolver
    networks:
      - web
      - default

networks:
  web:
    external: true
